# 推荐系统的基础知识

### 消费指标：

**短期指标：**

- 点击率 = 点击次数 / 曝光次数
- 点赞率=点赞次数/点击次数
- 收藏率=收藏次数/点击次数

**北极星指标（长期指标，更加重要）：**

- 用户规模： 日活用户，月活用户
- 消费：人均使用推荐的时常
- 发布渗透率，人均发布量



## 实验流程

1. 离线实验：历史数据，没有跟用户交互
2. 小流量AB测试：把算法部署到实际产品中，看新策略和旧策略哪个好
3. 全流量上线



## 推荐系统的链路

![image-20240906185546835](assets/image-20240906185546835-1725620149553-1.png)

**召回：**协同过滤，双塔模型，关注的作者等等

**排序：** 粗排（简单的模型）--> 精排（大模型） --> 重排



## 粗排算法

![image-20240906185930155](assets/image-20240906185930155-1725620385388-3.png)

### 重排

目的是做多样性抽样，比如MMR，DPP，从几百中选出几十篇

用规则打散相似的内容

插入广告、运营推广内容



## A/B测试

离线实验结果正向不一定对线上指标有影响。

A/B测试可以用于选取最优参数。

怎么做：随机分桶：分b=10个桶，每个桶中有10%的用户，观察实验组和对照组之间的业务指标

**做A/B测试时流量不够用怎么办？**

分层实验：召回，粗排，精排，重拍，用户界面，广告

同层互斥，不同层正交

**Holdout机制：**

保留 10% 的⽤户，完全不受实验影响，可以考察整个部门对业务指标的贡献。



# 召回

## 基于物品的协同过滤ItemCF

![image-20240906235348249](assets/image-20240906235348249.png)

**物品之间的相似度：**两个物品的受众重合度越高，两个物品越相似

**基本思想：**如果用户对物品1感兴趣，而且物品1与物品2相似，那么用户很可能喜欢物品2.

相似度的计算实际上就是余弦相似性。

**事先做离线计算：**建立用户-->物品的索引；建立物品-->物品的索引。

**线上做召回：** 

1. 给定用户id，找到用户最近感兴趣的物品索引
2. 通过物品-->物品的索引，找到top-k相似物品；
3. 对于取回的相似物品，最多nk个，用公式预估用户对物品的兴趣分数
4. 返回分数最高的100个物品

用索引，离线计算量大，但是线上召回计算少



## Swing召回通道

与ItemCF非常像，只不过物品之间相似度的计算方式不同

Swing额外考虑重合的用户是否来自同一个小圈子，对于重合度高的用户提供的权重越小。



### 基于用户的协同过滤UserCF

推荐系统如何找到跟用户相似的网友？

- 看点击，收藏，转发的重合度
- 关注的作者重合度

**离线计算：**

- 计算用户之间的相似度
- 计算用户对物品的兴趣

即可通过当前用户之间的相似度×用户对物品的兴趣来预估当前用户对候选物品的兴趣。

