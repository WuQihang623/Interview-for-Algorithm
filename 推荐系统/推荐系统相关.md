# 推荐系统的基础知识

### 消费指标：

**短期指标：**

- 点击率 = 点击次数 / 曝光次数
- 点赞率=点赞次数/点击次数
- 收藏率=收藏次数/点击次数

**北极星指标（长期指标，更加重要）：**

- 用户规模： 日活用户，月活用户
- 消费：人均使用推荐的时常
- 发布渗透率，人均发布量



## 实验流程

1. 离线实验：历史数据，没有跟用户交互
2. 小流量AB测试：把算法部署到实际产品中，看新策略和旧策略哪个好
3. 全流量上线



## 推荐系统的链路

![image-20240906185546835](assets/image-20240906185546835-1725620149553-1.png)

**召回：**协同过滤，双塔模型，关注的作者等等

**排序：** 粗排（简单的模型）--> 精排（大模型） --> 重排



## 粗排算法

![image-20240906185930155](assets/image-20240906185930155-1725620385388-3.png)

### 重排

目的是做多样性抽样，比如MMR，DPP，从几百中选出几十篇

用规则打散相似的内容

插入广告、运营推广内容



## A/B测试

离线实验结果正向不一定对线上指标有影响。

A/B测试可以用于选取最优参数。

怎么做：随机分桶：分b=10个桶，每个桶中有10%的用户，观察实验组和对照组之间的业务指标

**做A/B测试时流量不够用怎么办？**

分层实验：召回，粗排，精排，重拍，用户界面，广告

同层互斥，不同层正交

**Holdout机制：**

保留 10% 的⽤户，完全不受实验影响，可以考察整个部门对业务指标的贡献。



## 向量召回

### 矩阵补充模型

用户embedding和物品embedding求内积

数据集：{用户id，物品id，兴趣分数}，数据集中的兴趣分数是系统记录的，比如：

- 曝光但是没有点击： 0
- 点击点赞收藏转发：各1分

把用户u映射成向量$a_u$，物品i映射成向量$b_i$

矩阵补充的含义：

![image-20240908141745692](assets/image-20240908141745692-1725776267767-1.png)

- 缺点1： 仅用ID embeding，没有利用物品，用户属性
- 缺点2：负样本的选取方式不对
- 缺点3：训练方法不好，内积不如余弦相似度，平方损失不如交叉熵

**模型存储：**

1. 训练得到矩阵A和B
   1. A的每一列对应用户
   2. B的每一列对应物品
2. 把矩阵A的列存储到key-value表：给定ID返回一个用户embedding
3. 矩阵B的存储和索引比较复杂

**线上服务：**

1. 把用户ID作为key，得到用户向量
2. 最近邻查找：如果枚举所有物品，时间复杂度正比于物品数量

**快速最近零查找：**



## 双塔模型
